<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta http-equiv="x-ua-compatible" content="ie=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
		<title>uibench (Dio.js)</title>
		<link rel="stylesheet" href="https://localvoid.github.io/uibench-base/0.1.0/styles.css">
		<script src="https://localvoid.github.io/uibench-base/0.1.0/uibench.js"></script>
		<script src="/dio.js"></script>
	</head>
	<body>
		<div id="App"></div>

		<script>
			function TableCell (props) {
				function onClick (e) {
					console.log('Clicked' + props.text);
	        		e.stopPropagation();
				}

				return {
	    			nodeType: 1,
	    			type: 'td',
	    			props: {className: 'TableCell', onClick: onClick},
	    			children: [
	    				{
	    					nodeType: 3,
	    					type: 'text',
	    					props: {},
	    					children: [props.text]
	    				}
    				]
	    		}
			}

			function TableRow (props) {
			    var data = props.data;
			    var classes = 'TableRow';

			    if (data.active) {
		      		classes = 'TableRow active';
			    }

			    var cells = data.props;
			    var length = cells.length;
			    var children = new Array(length+1);

			    children[0] = TableCell({text: '#' + data.id});

			    for (var i = 0; i < length; i++) {
		      		children[i+1] = TableCell({text: cells[i]});
			    }

		    	return {
		    		nodeType: 1,
		    		type: 'tr',
		    		props: {className: classes, 'data-id': data.id},
		    		children: children
	    		}
			}

			function Table (props) {
				var items    = props.data.items;
		    	var length   = items.length;
		    	var children = new Array(length);

	    		for (var i = 0; i < length; i++) {
					var item = items[i];

					children[i] = TableRow({key: item.id, data: item});
	    		}

		    	return {
		    		nodeType: 1,
		    		type: 'table',
		    		props: {className: 'Table'},
		    		children: [
		    			{
		    				nodeType: 1,
		    				type: 'tbody',
		    				props: {},
		    				children: children
		    			}
		    		]
		    	}
			}

			function AnimBox (props) {
				var data = props.data;
		    	var time = data.time;
	    		var style = 'border-radius:'+(time % 10)+'px;background:rgba(0,0,0,'+(0.5 + ((time % 10) / 10))+');';

				return {
					nodeType: 1,
					type: 'div',
					props: {className: 'AnimBox', 'data-id': data.id, style: style},
					children: []
				}
			}

			function Anim (props) {
	    		var data   = props.data;
		    	var items  = data.items;
		    	var length = items.length;

	    		var children = new Array(length);

	    		for (let i = 0; i < length; i++) {
	      			var item = items[i];
	      			children[i] = AnimBox({key: item.id, data: item});
	    		}

		    	return {
		    		nodeType: 1,
		    		type: 'div',
		    		props: {className: 'Anim'},
		    		children: children
		    	}
			}

			function TreeLeaf (props) {
				return {
					nodeType: 1,
					type: 'li',
					props: {className: 'TreeLeaf'},
					children: [
						{
							nodeType: 3,
							type: 'text',
							props: {},
							children: [props.data.id]
						}
					]
				}
			}

			function TreeNode (props) {
			    var data = props.data;
			    var dataChildren = data.children;
			    var length = dataChildren.length;
			    var children = new Array(length);

			    for (let i = 0; i < length; i++) {
		      		var n = dataChildren[i];

		      		if (n.container) {
			        	children[i] = TreeNode({key: n.id, data: n});
		      		} else {
			        	children[i] = TreeLeaf({key: n.id, data: n});
		      		}
			    }

			    return {
			    	nodeType: 1,
			    	type: 'ul',
			    	props: {className: 'TreeNode'},
			    	children: children
			    }
			}

			function Tree (props) {
				return {
					nodeType: 1,
					type: 'div',
					props: {className: 'Tree'},
					children: [
						TreeNode({data: props.data.root})
					]
				}
			}

		 	function Main (data) {
			    var location = data.location;

			    var section;

			    if (location === 'table') {
		      		section = Table({data: data.table});
			    } else if (location === 'anim') {
		      		section = Anim({data: data.anim});
			    } else if (location === 'tree') {
		      		section = Tree({data: data.tree});
			    }

			    var children = [];

			    if (section) {
			    	children[0] = section;
			    }

			    return {
			    	nodeType: 1,
			    	type: 'div', 
			    	props: {className: 'Main'}, 
			    	children: children
			    };
		    }

		    function Output (samples) {
		    	return {
					type: 'pre',
					props: {},
					children: [
						{
							nodeType: 3,
							type: 'text',
							props: {},
							children: [JSON.stringify(samples, null, ' ')]
						}
					]
				}
		    }

			uibench.init('DIO', dio.version);

			document.addEventListener('DOMContentLoaded', function (e) {
		  		var container = document.querySelector('#App');

			  	uibench.run(
				    function(state) {
				    	dio.render(Main(state), container);
				    },
				    function(samples) {
				    	dio.render(Output(samples), container);
				    }
		  		);
			});
		</script>
	</body>
</html>