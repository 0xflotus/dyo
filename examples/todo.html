<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta http-equiv="x-ua-compatible" content="ie=edge">
		<title>surl.js - Todo App Example</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
		<link rel="icon" href="data:;base64,iVBORw0KGgo=">
		<script src="/dist/surl.min.js"></script>
		<link rel="stylesheet" href="assets/style.css">
	</head>
	<body>
		<div class="app"></div>
		<br><br>
		<div id="counter"></div>

		<script>
			var 
			app = new surl()

			var // define components
			TodoItem = app.Component({
				// shouldComponentUpdate: function (nextProps, nextState) {
				// 	console.log('shouldComponentUpdate: ', this, arguments)
				// },
				componentWillMount: function() {
					// console.log('componentWillMount:', this, arguments)
				},
				componentDidMount: function(node) {
					// console.log('componentDidMount: ', this, arguments, node)
				},
				componentWillUnmount: function (node) {
					// console.log('componentWillUnmount', this, arguments, node)
				},
				componentWillReceiveProps: function(nextProps) {
					// console.log('componentWillReceiveProps: ', this, arguments)
				},
				componentWillUpdate: function(nextProps, nextState) {
					// console.log('componentWillUpdate: ', this, arguments)
				},
				componentDidUpdate: function(prevProps, prevState) {
					// console.log('componentDidUpdate: ', this, arguments)
				},
				render: function (props, state) {
					// references
					var 
					item = props.item

					return h('li',
								{
									onclick: props.handleDelete, 
									id: item.id, 
									class: Date.now(),
									style: 'cursor:pointer;',
									className: {what: true, something: false},
									key: item.id
								},
								item.text
							)
				}
			}),

			TodoList = app.Component({
		  		render: function(props) {
		  			// references
		  			var 
		  			items = props.items,
		  			handleDelete = props.handleDelete

			    	return h('ul', 
			    				// for each item return a TodoItem Component
			    				items.map(function (value) {
			    					return TodoItem({item: value, handleDelete: handleDelete})
			    				})
	    					)
		  		}
			}),

			TodoApp = app.Component({
				componentWillMount: function() {
					// console.log('componentWillMount:', this, arguments)
				},
				componentDidMount: function(node) {
					// console.log('componentDidMount: ', this, arguments, node)
				},
				componentWillUnmount: function (node) {
					// console.log('componentWillUnmount', this, arguments, node)
				},
		  		getInitialState: function() {
		  			// initial data
		    		return {items: 
		    			[
			    			{id: 1234, text: 'Default'},
			    			{id: 0234, text: 'Something'},
			    			{id: 4234, text: 'Else....'},
			    			{id: 9303, text: 0},
			    			{id: 9103, text: null},
			    			{id: 9803, text: void 0},
			    			{id: 9903, text: false}
	    				], 
	    				text: ''
	    			}
		  		},
		  		handleSubmit: function (e) {
		  			// prevent default form submit behaviour
		    		e.preventDefault()

		    		// references
		    		var
		    		text = this.state.text

    				if (text) {
    					// add item to items array
	    				var 
	    				nextItems = this.state.items.concat({text: text, id: Date.now()})

	    				// update state
		    			this.setState({items: nextItems, text: ''})
	    			}
		  		},
		  		handleDelete: function (e) {
		  			// references
		  			var 
		  			self = this,
		  			node = e.currentTarget,
		  			id   = node.id

		  			self.state.items.forEach(function(value, index, arr){
		  				if (value.id == id) {
		  					// get part of array from 0 to item's index
		  					// then skip the element we want to delete and add 
		  					// everything else after that
		  					var 
		  					items = arr.slice(0, index).concat(arr.slice(index+1))

		  					// animate node out then update state
		  					animate.transition('slideUp')(node, function(){
		  						self.setState({items: items})
		  					})
		  				}
		  			})
		  		},
		  		render: function (props, state) {
		  			return h('div',
		  						h('h3', 'TODO'),
		  						h('form', {onsubmit: this.handleSubmit},
		  							h('input', {oninput: bind('value', this, 'text'), value: state.text}),
		  							h('button', 'Add #' + (state.items.length+1))
  								),
  								TodoList({items: state.items, handleDelete: this.handleDelete})
		  					)
		  		}
			})

			// mount to dom
			app.render(TodoApp, '.app')


			// flux/reduxy stuff
			var 
			store = app.createStore(function (state, action) {
				state = state || 0

				switch (action.type) {
					case 'INCREMENT':
						return state + 1;
					case 'DECREMENT':
						return state - 1;
					default:
						return state;
				}
			})

			var
			render = function () {
				document.getElementById('counter').innerText = store.getState()
			}

			store.subscribe(render)
			render()

			document.addEventListener('click', function () {
				store.dispatch({type: 'INCREMENT'})
			})
		</script>
	</body>
</html>