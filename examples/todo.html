<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta http-equiv="x-ua-compatible" content="ie=edge">
		<title>surl.js - Todo App Example</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
		<link rel="icon" href="data:;base64,iVBORw0KGgo=">
		<script src="/dist/surl.js"></script>
		<link rel="stylesheet" href="assets/style.css">
	</head>
	<body>
		<div class="app"></div>
		<script>
			var app = new surl();

			var // define components
			TodoItem = app.Component({
				shouldComponentUpdate: function (nextProps, nextState) {
					// console.log('componentDidMount: ', this, arguments)
				},
				componentWillMount: function(node) {
					// console.log('componentWillMount:', this, arguments, node)
				},
				componentDidMount: function(node) {
					// console.log('componentDidMount: ', this, arguments, node)
				},
				componentWillReceiveProps: function(nextProps) {
					// console.log('componentWillReceiveProps: ', this, arguments)
				},
				componentWillUpdate: function(nextProps, nextState) {
					// console.log('componentWillUpdate: ', this, arguments)
				},
				componentDidUpdate: function(prevProps, prevState) {
					// console.log('componentDidUpdate: ', this, arguments)
				},
				componentWillUnmount: function(node) {
					// console.log('componentWillUnmount:', this, arguments, node)

					// this does two things
					// 1. animates the node that is about to be removed from the dom
					// 2. tells the render process to remove this node after 400(ms)
					// It works in one line because animate('className', duration)(node)
					// returns the duration value, so you also do it like
					// animate('fadeOut', 400)(node)
					// return 400
					return animate('fadeOut', 400)(node)
				},
				render: function () {
					var item = this.props.item;
					return h('li',
								{onclick: this.props.handleDelete, id: item.id, className: item.id, style: 'cursor:pointer;'}, 
								item.text
							)
				}
			}),

			TodoList = app.Component({
		  		render: function() {
		  			var items = this.props.items,
		  				handleDelete = this.props.handleDelete;

			    	return h('ul', 
			    				items.map(function (value) {
			    					return TodoItem({item: value, handleDelete: handleDelete})
			    				})
	    					)
		  		}
			}),

			TodoApp = app.Component({
		  		getInitialState: function() {
		    		return {items: [{id: 1234, text: 'Default'}], text: ''}
		  		},
		  		handleSubmit: function (e) {
		    		e.preventDefault();
		    		var text = this.state.text;

    				if (text) {
	    				var nextItems = this.state.items.concat([{text: text, id: Date.now()}]);
		    			this.setState({items: nextItems, text: ''})
	    			}
		  		},
		  		handleDelete: function (e) {
		  			var value = e.currentTarget.id,
		  				items = this.state.items;

		  			items.forEach(function(a,b){
		  				if (a.id == value) {
							items.splice(b, 1)		  					
		  				}
		  			});

		  			this.setState({items: items});
		  		},
		  		render: function () {
		  			return h('div',
		  						h('h3', 'TODO'),
		  						h('form', {onsubmit: this.handleSubmit},
		  							h('input', {oninput: bind('value', this, 'text'), value: this.state.text}),
		  							h('button', 'Add #' + (this.state.items.length+1))
  								),
  								TodoList({items: this.state.items, handleDelete: this.handleDelete})
		  					)
		  		}
			});

			// mount to dom
			app.Render(TodoApp, '.app');

			console.log(app)
		</script>
	</body>
</html>