<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta http-equiv="x-ua-compatible" content="ie=edge">
		<title>surl.js - Todo App Example</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
		<link rel="icon" href="data:;base64,iVBORw0KGgo=">
		<script src="/dist/surl.min.js"></script>
		<link rel="stylesheet" href="assets/style.css">
	</head>
	<body>
		<div class="app"></div>

		<script>


			// ------------------------- initializers ------------------------- //


			var router = s.router({
				root: '/examples',
				routes: {
					'/router.html': function () {
						console.log(arguments)
					}
				}
			})

			var render  = s.render(TodoApp, '.app')

			s.request.get('?url')

			// ------------------------- store ------------------------- //


			var store = s.store(function (state, action) {
				state = state || {items: [], text: ''}

				switch (action.type) {
					case 'ADD':
						return Object.assign({}, state, {
							items: state.items.concat({
								id: action.id,
								value: action.value, 
								completed: false
							})
						})
					case 'TOGGLE':
						return state.map(function (item) {
							if (item.id !== action.id) {
								return todo
							}

							return Object.assign({}, item, {completed: !item.completed})
						})
					case 'REMOVE':
						return Object.assign({}, state, {
							items: state.items.filter(function (item) {
								if (item.id != action.id) {
									return item
								}
							})
						})
					case 'FILTER':
						return Object.assign({}, state, {
							items: state.items.filter(function (item) {
								var 
								keys   = Object.keys(action).slice(1)
								length = keys.length

								for (var i = 0, value = keys[i]; i < length; i++) {
									return action[value] == item[value]
								}
							})
						})
					default:
						return state
				}
			})


			store.connect(render)


			// ------------------------- components ------------------------- //


			function TodoItem (props) {
				return h('li', {onclick: props.handleDelete, id: props.item.id, style: 'cursor:pointer;', key: props.item.id}, props.item.value)
			}
			function TodoList (props) {
		    	return h('ul', props.items.map(function (value) {
		    					return TodoItem({item: value, handleDelete: props.handleDelete})
		    				})
    					)
			}
			function TodoApp (props) {
				var 
				text = s.prop(''),
				input = s.prop('')
				// will always contain the value of input.value oninput

		  		function handleSubmit (e) {
		    		e.preventDefault()
		    		var 
		    		value = text()
	    			store.dispatch({type:'ADD', id: Date.now(), value: value})
	    			input().value = ''
		  		}
		  		function handleDelete () {
		  			var node = this
		  			s.animate.transition('slideUp')(node, function(){
		  				store.dispatch({type: 'REMOVE', id: node.id})
		  			})
		  		}
		  		function render (props) {
		  			return h('div',
		  						h('h3', 'TODO'),
		  						h('form', {onsubmit: this.handleSubmit},
		  							h('input', {ref: input, oninput: s.bind(['value'], [text])}),
		  							h('button', 'Add #' + (props.items.length+1))
  								),
  								TodoList({items: props.items, handleDelete: handleDelete})
		  					)
		  		}
		  		return {
		  			render: render,
		  			handleSubmit: handleSubmit
		  		}
			}

			console.log(render({items: []}, null, 'html'))
		</script>
	</body>
</html>