<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta http-equiv="x-ua-compatible" content="ie=edge">
		<title>surl.js - Todo App Example</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
		<link rel="icon" href="data:;base64,iVBORw0KGgo=">
		<script src="/dist/surl.js"></script>
	</head>
	<body>
		<div class="app"></div>
		<script>
			var app = new surl();

			var // define components
			TodoItem = app.Component({
				shouldComponentUpdate: function (nextProps, nextState) {
					// console.log('componentDidMount: ', this, arguments)
				},
				componentDidMount: function() {
					// console.log('componentDidMount: ', this, arguments)
				},
				componentWillReceiveProps: function(nextProps) {
					// console.log('componentWillReceiveProps: ', this, arguments)
				},
				componentWillUpdate: function(nextProps, nextState) {
					// console.log('componentWillUpdate: ', this, arguments)
				},
				componentDidUpdate: function(prevProps, prevState) {
					// console.log('componentDidUpdate: ', this, arguments)
				},
				componentWillUnmount: function() {
					// console.log('componentWillUnmount:', this, arguments)
				},
				render: function () {
					var item = this.props.item;
					return h('li', {onclick: this.props.delete, id: item.id, className: item.id, style: 'cursor:pointer;'}, item.text)
				}
			}),
			TodoList = app.Component({
		  		render: function() {
		  			var self = this;
			    	return h('ul', 
			    				this.props.items.map(function (value) {
			    					return TodoItem({item: value, delete: self.props.delete})
			    				})
	    					)
		  		}
			}),
			TodoApp = app.Component({
				componentWillMount: function() {
					// console.log('componentWillMount:', this, arguments)
				},
		  		getInitialState: function() {
		    		return {items: [], text: ''}
		  		},
		  		handleSubmit: function (e) {
		    		e.preventDefault();
		    		var text = this.state.text;

    				if (window.raf) {
    					cancelAnimationFrame(window.raf)
    				}

    				if (text) {
	    				var nextItems = this.state.items.concat([{text: text, id: Date.now()}]);
		    			this.setState({items: nextItems, text: ''})
	    			}

	    			console.log(this.state)
		  		},
		  		handleDelete: function (e) {
		  			var value = e.currentTarget.id,
		  				items = this.state.items;

		  			items.forEach(function(a,b){
		  				if (a.id == value) {
							items.splice(b, 1)		  					
		  				}
		  			});

		  			this.setState({items: items});
		  		},
		  		render: function () {
		  			return h('div',
		  						h('h3', 'TODO'),
		  						h('form', {onsubmit: this.handleSubmit},
		  							h('input', {oninput: bind('value', this, 'text'), value: this.state.text}),
		  							h('button', 'Add #' + (this.state.items.length+1))
  								),
  								TodoList({items: this.state.items, delete: this.handleDelete})
		  					)
		  		}
			});

			// mount to dom
			app.Render(TodoApp, '.app');

			console.log(app)
		</script>
	</body>
</html>