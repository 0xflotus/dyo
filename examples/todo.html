<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta http-equiv="x-ua-compatible" content="ie=edge">
		<title>surl.js - Todo App Example</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
		<link rel="icon" href="data:;base64,iVBORw0KGgo=">
		<script src="/dist/surl.js"></script>
		<link rel="stylesheet" href="assets/style.css">
	</head>
	<body>
		<div class="app"></div>
		<script>
			var app = new surl();

			var // define components
			TodoItem = app.Component({
				shouldComponentUpdate: function (nextProps, nextState) {
					// console.log('componentDidMount: ', this, arguments)
				},
				componentWillMount: function(node) {
					console.log('componentWillMount:', this, arguments, node)
				},
				componentDidMount: function(node) {
					console.log('componentDidMount: ', this, arguments, node)
				},
				componentWillReceiveProps: function(nextProps) {
					// console.log('componentWillReceiveProps: ', this, arguments)
				},
				componentWillUpdate: function(nextProps, nextState) {
					// console.log('componentWillUpdate: ', this, arguments)
				},
				componentDidUpdate: function(prevProps, prevState) {
					// console.log('componentDidUpdate: ', this, arguments)
				},
				componentWillUnmount: function(node) {
					animate('fade')(node);

					console.log('componentWillUnmount:', this, arguments, node)
					return 200
				},
				render: function () {
					var item = this.props.item;
					return h('li', {onclick: this.props.delete, id: item.id, className: item.id, style: 'cursor:pointer;'}, item.text)
				}
			}),
			TodoList = app.Component({
		  		render: function() {
		  			var self = this;
			    	return h('ul', 
			    				this.props.items.map(function (value) {
			    					return TodoItem({item: value, delete: self.props.delete})
			    				})
	    					)
		  		}
			}),
			TodoApp = app.Component({
				componentWillMount: function(node) {
					console.log('componentWillMount:', this, arguments, node)
				},
		  		getInitialState: function() {
		    		return {items: [{id: 1234, text: 'Default'}], text: ''}
		  		},
		  		handleSubmit: function (e) {
		    		e.preventDefault();
		    		var text = this.state.text;

    				if (text) {
	    				var nextItems = this.state.items.concat([{text: text, id: Date.now()}]);
		    			this.setState({items: nextItems, text: ''})
	    			}
		  		},
		  		handleDelete: function (e) {
		  			var value = e.currentTarget.id,
		  				items = this.state.items;

		  			items.forEach(function(a,b){
		  				if (a.id == value) {
							items.splice(b, 1)		  					
		  				}
		  			});

		  			this.setState({items: items});
		  		},
		  		render: function () {
		  			return h('div',
		  						h('h3', 'TODO'),
		  						h('form', {onsubmit: this.handleSubmit},
		  							h('input', {oninput: bind('value', this, 'text'), value: this.state.text}),
		  							h('button', 'Add #' + (this.state.items.length+1))
  								),
  								TodoList({items: this.state.items, delete: this.handleDelete})
		  					)
		  		}
			});

			// mount to dom
			app.Render(TodoApp, '.app');

			console.log(app)
		</script>


		<script>
			function Promise (fn) {
		  		var 
		  		state = 'pending',
		  		value,
		  		deferred;

		  		function resolve (newValue) {
		    		value = newValue;
		    		state = 'resolved';

		    		if (deferred) {
	     		 		handle(deferred);
		    		}
		  		}

		  		function handle (onResolved) {
		    		if(state === 'pending') {
		      			deferred = onResolved;
		      			return
		    		}

		    		onResolved(value);
		  		}

		  		this.then = function (onResolved) {
		    		handle(onResolved);
		  		};

		  		fn(resolve);
			}

			function doSomething() {
		  		return new Promise(function(resolve) {
			    	var value = 42;
			    	resolve(value);
		  		});
			}

			doSomething().then(function(){
				console.log(1);
			})
		</script>
	</body>
</html>