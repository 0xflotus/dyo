<html>
<body>
	<div id=root></div>

	<script src="../dist/dio.js"></script>

	<script src="perf-monitor.js"></script>
	<script src="env.js"></script>
	<link rel="stylesheet" href="stylesheet.css">

	<script>
		const target = document.getElementById('root');
		const h = dio.createElement;
		const Component = dio.Component;

		function dbmon () {
			'use strict';

			class Monster extends Component {
				render () {
					return (
						h('div',
							h('table', {className: 'table table-striped latest-data'},
								h('tbody',
									data.map(function (db) {
										return h('tr',
											h('td', {className: 'dbname'}, db.dbname),
											h('td', {className: 'query-count'},
												h('span', {className: db.lastSample.countClassName}, db.lastSample.nbQueries)
											),
											db.lastSample.topFiveQueries.map(function (query) {
												return h('td', {className: query.elapsedClassName},
													query.formatElapsed,
													h('div', {className: 'popover left'},
														h('div', {className: 'popover-content'}, query.query),
														h('div', {className: 'arrow'}, null)
													)
												)
											})
										)
									})
								)
							)
						)
					);
				}
			}

			perfMonitor.startFPSMonitor()
			perfMonitor.startMemMonitor()
			perfMonitor.initProfiler("render");

			var data = [];
			// var factory = dio.factory(h(Monster), target);

			function loop() {
				data = ENV.generateData().toArray();
				perfMonitor.startProfile("render");

				// factory();
				dio.render(Monster, target);

				perfMonitor.endProfile("render");
				requestAnimationFrame(loop);
			}

			loop();
		}

		dbmon();
	</script>
</body>
</html>
