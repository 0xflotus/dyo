<html>
<body>
	<div id=root>...</div>
	<div id="portal"></div>
	<script src="../dist/dio.js"></script>

	<script>
		// TODO: test switch components willMount/willUnmount calls
		const root = document.getElementById('root');

		var node = document.getElementById('portal');
		// var hoist = h(Bars, {id: 1, class: 'old'}, 1, 2, 3);
		// var clone = h(hoist, {id: 2, value: 'new'}, 4, 5, 6);
		// var portal = h(node, [1, 2]);

		// var el = h('h1', {}, 1, 2);
		var tag = 'h1';
		var tag = () => {};

		var el = h(tag, 1, 2, [3, 4, [5, 6]], h('h2', ['Hello', 'World']));

		console.log(el);

		function Bars () {}

		const refs = function (node) {
			return {n: this.state.n+1}
		}

		class S {
			componentWillUnmount() {
				console.log('willUnmount - S')
			}
			render() {
				return F
			}
		}

		class F {
			componentWillUnmount() {
				console.log('willUnmount - F')
			}
			render() {

			}
		}

		class R {
			componentWillMount() {
				console.log('willMount - R')
			}
			render() {

			}
		}

		dio.render(S);
		dio.render(R);

		// class Testing {
		// 	componentDidMount() {
		// 		// return {n: this.state.n+1}
		// 	}
		// 	getInitialState() {
		// 		return {n: 0}
		// 	}
		// 	render() {
		// 		return h('h1', {
		// 			ref: (node) => {
		// 				// return {n: this.state.n+1}
		// 			}
		// 		}, this.state.n)
		// 	}
		// }

		// dio.render(Testing)
		// dio.render(Testing)

		// console.log(hoist, clone, portal);

		// dio.render(h(node, [1, 2]));
		// setTimeout(function () {
		// 	dio.render(h(node, [1, 2, 3, 4]));
		// }, 1000)

		const animation = {
			fadeOut: [
			  {transform: 'translateY(0)', opacity: 1},
		  	{transform: 'translateY(-100%)', opacity: 0}
		  ],
		  fadeIn: [
	  	  {transform: 'translateY(-100%)', opacity: 0},
	    	{transform: 'translateY(0%)', opacity: 1}
		  ]
		};

		function fadeIn (el) {
			return el.animate(animation.fadeIn, {delay: 200, duration: 200, fill: 'backwards'});
		}

		function fadeOut (el) {
			return el.animate(animation.fadeOut, {duration: 200});
		}

		class Input {
			componentDidThrow () {
				console.log('didThrow');
				return h('h1', 'Error state');
			}
			componentDidMount(el) {
				fadeIn(el);
			}
			componentWillUnmount(el) {
				return new Promise((r) => fadeOut(el).onfinish = r)
			}
			handleInput(props, state, event) {
				const {target} = event
				const {value} = target
				return {value}
			}
			render() {
				return h('div',
					h('input', {
						type: 'text',
						oninput: this.handleInput
					}),
					h('h1', this.state.value)
				)
			}
		}

		class Input2 {
			handleInput(props, state, event) {
				const {target} = event
				const {value} = target
				return {value}
			}
			componentDidMount(el) {
				fadeIn(el)
			}
			render() {
				return h('div',
					h('input', {
						type: 'text',
						oninput: this.handleInput,
						defaultValue: 'something'
					}),
					h('h1', this.state.value)
				)
			}
		}

		class App {
			render () {
				return this.props.children
			}
		}

		// dio.render(h(App, Input, Input, Input), root);

		// setTimeout(dio.render, 1000, h(App, Input, Input, Input, Input), root);
		// setTimeout(dio.render, 2000, h(App, Input, Input, Input), root);

		class A {
		  componentWillUnmount() {console.log('unmount - A')}
		  render() {return B}
		}

		class B {
		  componentWillUnmount() {console.log('unmount - B')}
		  render() {return C}
		}

		class C {
		  componentWillUnmount() {console.log('unmount - C')}
		  render() {return 'C'}
		}

		// dio.render(A, document.getElementById('app'))
		// dio.render('Replace', document.getElementById('app'))

		// dio.render(h('button', {onclick: (e)=>console.log(e)}, 'Click Me'))

		const animations = {
			fadeOut: [
			  {transform: 'translateY(0)', opacity: 1},
		  	{transform: 'translateY(-100%)', opacity: 0}
		  ],
		  fadeIn: [
			  {transform: 'translateY(-100%)', opacity: 0},
		  	{transform: ' translateY(0%)', opacity: 1}
		  ]
		}

		class Item {
			componentDidMount(el) {
				el.animate(animations.fadeIn, {
					duration: 200
				});
			}
			componentWillUnmount(el) {
				return new Promise((resolve) => {
					el.animate(animations.fadeOut, {
						duration: 200
					}).onfinish = resolve
				})
			}
			render() {
				return h('li', {
					ref: ref
				}, this.props.children)
			}
		}

		const ref = (a) => {
			console.log(a);
		}

		class List {
			render() {
				return [
					h('svg', {width: 500, height: 40, viewBox: '0 0 500 40'},
						h('text', {x: 0, y: 35, 'font-family': 'Verdana', 'font-size': 35}, 'Hello, out there')
					),
					h(`svg`,
	       		[1, 2, 3, 4, 5, 6, 7, 8, 9, 10].map(id => (
		         	h(`g`, {
			           'key': id,
		         	},
	           		h(`circle`, {
	           			'cx': 5 + 10 * id,
	           			'cy': 5,
	           			'r': 5,
		           	})
		         	)
		       	))
		     	),
					h('br'),
					X,
					foo,
					h('ul', this.props.children.map(
						v => h(Item, v)
					))
				]
			}
		}

		// dio.render(h(List, 1, 2, 3), root)

		var state = 0;

		class X {
			componentWillUnmount() {
				console.log('willUnmount - ', this.constructor.name);
			}
			componentWillMount() {
				console.log('willMount - ', this.constructor.name);
			}
			componentDidUpdate() {
				console.log('didUpdate - ', this.constructor.name);
			}
			render () {
				return [
					100,
					{id: 1, name: 'Hello', nest: {age: 20}}
				]
				return Y;
			}
		}

		class Y {
			componentWillUnmount() {
				console.log(this.this);
				console.log('willUnmount - ', this.constructor.name);
			}
			componentWillMount() {
				console.log('willMount - ', this.constructor.name);
			}
			componentDidUpdate() {
				console.log('didUpdate - ', this.constructor.name);
			}
			render () {
				return state > 1 ? E : Z;
			}
		}

		class Z {
			componentWillUnmount() {
				console.log(this.this);
				console.log('willUnmount - ', this.constructor.name);
			}
			componentWillMount() {
				console.log('willMount - ', this.constructor.name);
			}
			componentDidUpdate() {
				console.log('didUpdate - ', this.constructor.name);
			}
			render() {
				return h('h1', 'I Am Z - ', state++)
			}
		}

		class E {
			componentWillUnmount() {
				console.log('willUnmount - ', this.constructor.name);
			}
			componentWillMount() {
				console.log('willMount - ', this.constructor.name);
			}
			componentDidUpdate() {
				console.log('didUpdate - ', this.constructor.name);
			}
			render () {
				return h('h2', 'I Am E - ', Date.now());
			}
		}

		// dio.render(X, root);

		function event (e) {
			console.log(this, e)
		}

		function foo () {
			return h('button', {onclick: event}, 'Click Me - ', performance.now());
		}

		// dio.render(X, root);

		// setTimeout(()=>dio.render(X, root), 1000)
		// setTimeout(()=>dio.render(X, root), 2000)
		// setTimeout(()=>dio.render(null, root), 3000)

		class Lists {
			render() {
				console.log(this.props);

				return h('ul', this.props.children.map(
					v => h(Item, {key: v}, v)
				))
			}
		}

		// dio.render(h(Lists, 1, 2, 3), root, 'destroy');

		// setTimeout(dio.render, 1000, h(Lists, 1, 2), root)
		// setTimeout(dio.render, 2000, h(Lists, 1, 2, 3, 4), root)
		// setTimeout(dio.render, 2000, h(Lists), root)
		// setTimeout(dio.render, 4000, h(Lists, 1, 2, 3, 4), root)


		class Foo {
			componentWillMount() {
				console.log(true, 'componentWillMount');
			}
			componentDidMount() {
				console.log(true, 'componentDidMount');
			}
			componentWillUpdate() {
				console.log(true, 'componentWillUpdate');
			}
			componentDidUpdate() {
				console.log(true, 'componentDidUpdate');
			}
			componentWillReceiveProps() {
				console.log(true, 'componentWillReceiveProps');
			}
			componentWillUnmount() {
				console.log(true, 'componentWillUnmount');
			}
			shouldComponentUpdate() {
				console.log(true, 'shouldComponentUpdate');
			}
			render() {
				return h(Bar, this.props);
			}
		}

		class Bar {
			componentWillUpdate() {
				console.log(true, 'componentWillUpdate - composite');
			}
			componentDidUpdate() {
				console.log(true, 'componentDidUpdate - composite');
			}
			render() {
				return h('h1', this.props.id);
			}
		}

		// dio.render(h(Foo, {id: 1}));
		// dio.render(null);

		// replace
		// remove
		// preserve [default]
	</script>
</body>
</html>
