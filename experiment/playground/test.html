<!doctype html>
<body>
	<div id='app'></div>
	<div id="root"></div>
	<!-- <div id=root>
		<h1><input type="text">Hello World 1494293784665 <p>Paragraph</p></h1>
	</div> -->
	<!-- <div id=root>
		<h1>Hello World 1494293784665</h1>
	</div> -->
	<!-- <div id=root><h1>Hello World 1494293784665 <p>Paragraph</p></h1></div> -->
	<div id="portal"></div>
	<script src="../dio.js"></script>

	<script>
		h('!doctype', )
		const Component = dio.Component;
		// <!-- [if lte IE 9]>
	  	// <script src="/public/media.match.js">
		// <![endif]-->

		// dio.render(h('!', 'comment'), document.body)

		// var time = 0;

		// class Error {
		// 	render () {
		// 		if (time++ === 1) throw ''
		// 			return 'works'
		// 	}
		// }

		// dio.render(Promise.resolve('something when wrong'))
		// dio.render(Error)
		// dio.render(h('div'), req, () => {})
	</script>

	<script>
		const root = document.getElementById('root');
		const node = document.getElementById('portal');

		class foo {
			render () {
				return bar
			}
		}

		class bar {
			render() {
				return h('h1', h('input', {value: 'chanegd', oninput: () =>{
					console.log('works');
				}}), 'Hello World - ', Date.now(),
					h('p', 'Paragraph')
					// h(node, 1, 2)
				)
			}
		}

		const animation = {
			fadeOut: [
			  {transform: 'translateY(0)', opacity: 1},
		  	{transform: 'translateY(-100%)', opacity: 0}
		  ],
		  fadeIn: [
	  	  {transform: 'translateY(-100%)', opacity: 0},
	    	{transform: 'translateY(0%)', opacity: 1}
		  ]
		};

		function fadeIn (el) {
			return el.animate(animation.fadeIn, {delay: 200, duration: 200, fill: 'backwards'});
		}

		function fadeOut (el) {
			return el.animate(animation.fadeOut, {duration: 200});
		}

		class Input {
			componentDidMount(el) {
				fadeIn(el);
			}
			componentWillUnmount(el) {
				return new Promise((r) => fadeOut(el).onfinish = r)
			}
			handleInput(props, state, event) {
				const {target} = event
				const {value} = target
				return {value}
			}
			render() {
				return h('div',
					h('input', {
						type: 'text',
						oninput: this.handleInput
					}),
					h('h1', this.state.value)
				)
			}
		}

		class App {
			render () {
				return this.props.children
			}
		}

		class A {
		  componentWillUnmount() {console.log('unmount - A')}
		  render() {return B}
		}

		class B {
		  componentWillUnmount() {console.log('unmount - B')}
		  render() {return C}
		}

		class C {
		  componentWillUnmount() {console.log('unmount - C')}
		  render() {return 'C'}
		}

		const animations = {
			fadeOut: [
			  {transform: 'translateY(0)', opacity: 1},
		  	{transform: 'translateY(-100%)', opacity: 0}
		  ],
		  fadeIn: [
			  {transform: 'translateY(-100%)', opacity: 0},
		  	{transform: ' translateY(0%)', opacity: 1}
		  ]
		}

		const ref = (a) => {
			// console.log(a);
		}

		class List {
			render() {
				return [
					X,
					foos,
					h('ul', this.props.children.map(
						v => h(Item, v)
					))
				]
			}
		}

		class X {
			componentWillUnmount() {
				console.log('willUnmount - ', this.constructor.name);
			}
			componentWillMount() {
				console.log('willMount - ', this.constructor.name);
			}
			componentDidUpdate() {
				console.log('didUpdate - ', this.constructor.name);
			}
			render () {
				return [
					100,
					{id: 1, name: 'Hello', nest: {age: 20}}
				]
				return Y;
			}
		}

		class Y {
			componentWillUnmount() {
				console.log(this.this);
				console.log('willUnmount - ', this.constructor.name);
			}
			componentWillMount() {
				console.log('willMount - ', this.constructor.name);
			}
			componentDidUpdate() {
				console.log('didUpdate - ', this.constructor.name);
			}
			render () {
				return state > 1 ? E : Z;
			}
		}

		class Z {
			componentWillUnmount() {
				console.log(this.this);
				console.log('willUnmount - ', this.constructor.name);
			}
			componentWillMount() {
				console.log('willMount - ', this.constructor.name);
			}
			componentDidUpdate() {
				console.log('didUpdate - ', this.constructor.name);
			}
			render() {
				return h('h1', 'I Am Z - ', state++)
			}
		}

		class E {
			componentWillUnmount() {
				console.log('willUnmount - ', this.constructor.name);
			}
			componentWillMount() {
				console.log('willMount - ', this.constructor.name);
			}
			componentDidUpdate() {
				console.log('didUpdate - ', this.constructor.name);
			}
			render () {
				return h('h2', 'I Am E - ', Date.now());
			}
		}

		var state = 0;

		function event (e) {
			return {};
		}

		function foos () {
			return h('button', {onclick: event}, 'Click Me - ', performance.now());
		}

		class Item {
			componentDidMount(el) {
				el.animate(animations.fadeIn, {
					duration: 200
				});
			}
			componentWillUnmount(el) {
				return new Promise((resolve) => {
					el.animate(animations.fadeOut, {
						duration: 200
					}).onfinish = resolve
				})
			}
			render() {
				return h('li', {
					// ref: ref
				}, this.props.children)
			}
		}

		class Lists {
			render() {
				return h('ul', 0, null, this.props.children.map(
					v => h(Item, {key: v}, v)
				))
			}
		}

		// dio.render(foo, root, h1);
		// dio.render({id: 1}, root);

		// dio.render(X, root);

		// setTimeout(()=>dio.render(X, root), 1000)
		// setTimeout(()=>dio.render(X, root), 2000)
		// setTimeout(()=>dio.render(null, root), 3000)

		// dio.render(h(App, Input, Input, Input), root);

		// setTimeout(dio.render, 1000, h(App, Input, Input, Input, Input), root);
		// setTimeout(dio.render, 2000, h(App, Input, Input, Input), root);

		dio.render(h(Lists, 1, 2, 3), root)
		setTimeout(dio.render, 500, h(Lists, 1, 2), root)

		// setTimeout(dio.render, 1000, h(Lists, 1, 2, 3, 4), root)
		// setTimeout(dio.render, 1500, h(Lists), root)
		// setTimeout(dio.render, 2000, h(Lists, 1, 2, 3, 4), root)
	</script>
</body>
</html>
