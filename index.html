<body>
	<div id="root"></div>
	<script src=dist/dio.js></script>
	<script>
		var React = dio
		var ReactDOM = dio
	</script>
	<!-- <script src=https://unpkg.com/react-router-dom/umd/react-router-dom.js></script> -->
	<script>
		(function () {
			var ReactRouterDOM = window.ReactRouterDOM || {}
			var {h, render, Component, Children} = dio
			var {BrowserRouter, Route, Link} = ReactRouterDOM
			var Router = BrowserRouter

			const Home = () => (
				h('div', h('h2', 'Home'))
			)

			const About = () => (
				h('div', h('h2', 'About'))
			)

			const Topic = ({ match }) => (
				h('div', h('h3', match.params.topicId))
			)

			const Topics = ({ match }) => (
				h('div',
					h('h2', 'Topics'),
					h('ul',
						h('li',
							h(Link, {to: `${match.url}/rendering`}, 'Rendering with React')
						),
						h('li',
							h(Link, {to: `${match.url}/components`}, 'Components')
						),
						h('li',
							h(Link, {to: `${match.url}/props-v-state`}, 'Props v. State')
						)
					),
					h(Route, {path: `${match.url}/:topicId`, component: Topic}),
					h(Route, {
						exact: true, 
						path: match.url, 
						render: () => h('h3', 'Please select topic')
					})
				)
			)

			const BasicExample = () => (
				h(Router,
					h('div',
						h('ul',
							h('li', h(Link, {to: '/'}, 'Home')),
							h('li', h(Link, {to: '/about'}, 'About')),
							h('li', h(Link, {to: '/topics'}, 'Topic'))
						),
						h('hr'),
						h(Route, {exact: true, path: '/', component: Home}),
						h(Route, {path: '/about', component: About}),
						h(Route, {path: '/topics', component: Topics})
					)
				)
			)

			const ParamsExample = () => (
				h(Router,
					h('div',
						h('h2', 'Accounts'),
						h('ul',
							h('li', h(Link, {to: '/netflix'}, 'Netflix')),
							h('li', h(Link, {to: '/zillow-group'}, 'Zillow Group')),
							h('li', h(Link, {to: '/yahoo'}, 'Yahoo')),
							h('li', h(Link, {to: '/modus-create'}, 'Modus Create'))
						),
						h(Route, {path: '/:id', component: Child})
					)
				)
			)

			const Child = ({ match }) => (
				h('div', h('h3', 'ID:', match.params.id))
			)

			// dio.render(h(ParamsExample), document.getElementById('root'))
			// dio.render(h(BasicExample), document.getElementById('root'))
		})()
	</script>

	<script>
		(function () {
			const {h, render, Component} = dio
			const root = document.getElementById('root')

			var iterable = {
				[Symbol.iterator]: function* () {
				    yield 1
				    yield 2
				    yield 3
				}
			}

			const animation = {
				fadeOut: [
				  {transform: 'translateY(0)', opacity: 1},
			  	{transform: 'translateY(-120%)', opacity: 0}
			  ],
			  fadeIn: [
				  {transform: 'translateY(-120%)', opacity: 0},
			  	{transform: 'translateY(0%)', opacity: 1}
			  ]
			}

			const handleClick = function (event) {
				return {name: 'handleClick', time: new Date}
			}

			class ContextProvider extends Component {
			  getChildContext() {
			    return {data: this.props.currentUser + ' - ' + performance.now()};
			  }
			  componentWillUnmount(node) {
		  		return new Promise((resolve) => {
		  			node.animate(animation.fadeOut, {
		  				duration: 200
		  			}).onfinish = resolve
		  		})
			  }
			  render() {
			  	return h(ContextConsumer, this.props)
			  }
			}

			class ContextConsumer {
			  render(props, state, context) {
			  	return h(Foo, this.props)
			  }
			}

			function Foo (props, state, context) {
				return h('div', h('button', {onClick: handleClick, ref: 'button'}, 'Click Me!'), {...props, ...state, ...context})
			}

			Foo.defaultProps = {
				statement: 'hello world'
			}

			class Bar {
				async render(props, state) {
					return h('div', h('button', {onClick: handleClick}, 'Click Me!'), {...state})
				}
			}

			class Timer {
			  constructor(props, context) {
			    this.state = { secondsElapsed: 0, value: '' }
			  }

			  tick() {
			    this.setState(prevState => ({
			      secondsElapsed: prevState.secondsElapsed + 1
			    }))
			  }

			  componentWillMount(node) {
			  	console.log(0, node)
			  }

			  componentDidMount(node) {
			  	console.log(1, node)
			  	console.log(2, dio.findDOMNode(this))
			    // this.interval = setInterval(() => this.tick(), 1000)
			  }

			  componentWillUnmount() {
			    clearInterval(this.interval)
			  }

			  componentDidCatch(err) {
			  	return err
			  }

			  handleEvent(e) {
			  	console.log(dio.findDOMNode(this), this)

			  	if (e.type === 'submit')
			  		e.preventDefault()
			  	return {secondsElapsed: this.state.secondsElapsed + 1,value: e.target.value||this.state.value}

			  	// this.setState({}, ()=>{
			  	// 	throw 'end'
			  	// })
			  }

			  render() {
			    return (
			    	// h('section',
			    	[
			    		h('div', 'Seconds Elapsed:', this.state.secondsElapsed),
			    		h('div', {style: 'background:red;', onClick: this}, h('button', {onClick: null}, 'button')),
			    		h('form', {onSubmit: this},
			    			h('input', {onInput: this, value: this.state.value}),
			    			h('input', {type: 'submit'})
			    		)
			    	]
			    	// )
			    )
			  }
			}

			class Main {
				componentDidCatch(err) {
					return err
				}
				componentDidMount(){
					console.log('componentDidMount')
				}
			  render() {
			  	throw new Error('Something wrong happened')

			  	return [
			  		h('head', 
			  			h('title', 'Hello World', performance.now()),
			  		),
			  		'Hello World',
			  		h('body', {ref: e=>console.log(-1, e)},
			  			h(Timer, {ref: e=>console.log(-2, e)})
			  		)
			  	]
			  }
			}

			class Hello {
				render({remove}) {
					return h('body', 
						h(ContextProvider, {currentUser: 'Sultan'})
					)
				}
			}

			// dio.Children.only(1)
			// dio.render(h(Main))
			// dio.render(h(ContextProvider, {currentUser: 'Sultan'}))

			class Faz {
				componentDidCatch(err){
					return err
				}
				handleEvent() {
					// return this.setState(()=>{throw 'end'})

					this.setState(new Promise(function () {
						throw 'end'
					}))
				}
				render() {
					return h(new Promise(()=>{throw 'end'}), 'Hello')
					// return new Date()
					// return {
					// 	id: 1,
					// 	name: 'id'
					// }
					return h('button', {onclick: this}, 'Button')
				}
			}


			dio.render(Faz, document.getElementById('root'))
		})()
	</script>
</body>
