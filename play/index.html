<!doctype html>
<body>
	<div id='app'></div>
	<div id="root"></div>

	<!-- <div id=root>
		<h1><input type="text">Hello World 1494293784665<p>Paragraph</p></h1>
	</div> -->

	<!-- <div id=root>
		<h1>Hello World 1494293784665</h1>
	</div> -->

	<!-- <div id=root><h1>Hello World 1494293784665 <p>Paragraph</p></h1></div> -->
	<div id="portal"></div>
	<script src="../dio.js"></script>

	<script>
		const app = document.getElementById('app');
		const root = document.getElementById('root');
		const node = document.getElementById('portal');
		const promise = new Promise ((resolve) => {
			setTimeout(() => {
				resolve({});
			}, 2000)
		})

		class DIO {
			async getInitialState() {
				return {
					name: 'Sultan'
				}
			}
			render () {
				return h('h1', this.state.name);
			}
		}

		// dio.render(DIO, root)

		// Promise.resolve(0).then(v=>{
		// 	return v+99
		// }).then(v => {
		// 	console.log(v)
		// })

		// setTimeout(()=>{
		// 	dio.render(DIO, root)
		// }, 3000)

		class foo {
			render () {
				return bar
			}
		}

		class bar {
			render() {
				return h('h1', h('input', {value: 'chanegd', oninput: () =>{
					console.log('works');
				}}), 'Hello World - ', Date.now(), h('p', 'Paragraph')
					// h(node, 1, 2)
				)
			}
		}

		// dio.render(foo, root, root.firstChild);

		const animation = {
			fadeOut: [
			  {transform: 'translateY(0)', opacity: 1},
		  	{transform: 'translateY(-100%)', opacity: 0}
		  ],
		  fadeIn: [
	  	  {transform: 'translateY(-100%)', opacity: 0},
	    	{transform: 'translateY(0%)', opacity: 1}
		  ]
		};

		function fadeIn (el) {
			return el.animate(animation.fadeIn, {delay: 200, duration: 200, fill: 'backwards'});
		}

		function fadeOut (el) {
			return el.animate(animation.fadeOut, {duration: 200});
		}

		class Input {
			componentDidMount(el) {
				fadeIn(el);
			}
			componentWillUnmount(el) {
				return new Promise((r) => fadeOut(el).onfinish = r)
			}
			handleInput(props, state, event) {
				const {target} = event
				const {value} = target
				return {value}
			}
			render() {
				return h('div',
					h('input', {
						type: 'text',
						oninput: this.handleInput
					}),
					h('h1', this.state.value)
				)
			}
		}

		class App {
			render () {
				return this.props.children
			}
		}

		class A {
		  componentWillUnmount() {console.log('unmount - A')}
		  render() {return B}
		}

		class B {
		  componentWillUnmount() {console.log('unmount - B')}
		  render() {return C}
		}

		class C {
		  componentWillUnmount() {console.log('unmount - C')}
		  render() {return 'C'}
		}

		const animations = {
			fadeOut: [
			  {transform: 'translateY(0)', opacity: 1},
		  	{transform: 'translateY(-100%)', opacity: 0}
		  ],
		  fadeIn: [
			  {transform: 'translateY(-100%)', opacity: 0},
		  	{transform: ' translateY(0%)', opacity: 1}
		  ]
		}

		const ref = (a) => {
			// console.log(a);
		}

		class List {
			render() {
				return [
					X,
					foos,
					h('ul', this.props.children.map(
						v => h(Item, v)
					))
				]
			}
		}

		class X {
			componentWillUnmount() {
				console.log('willUnmount - ', this.constructor.name);
			}
			componentWillMount() {
				console.log('willMount - ', this.constructor.name);
			}
			componentDidUpdate() {
				console.log('didUpdate - ', this.constructor.name);
			}
			render () {
				return [
					100,
					{id: 1, name: 'Hello', nest: {age: 20}}
				]
				return Y;
			}
		}

		class Y {
			componentWillUnmount() {
				console.log(this.this);
				console.log('willUnmount - ', this.constructor.name);
			}
			componentWillMount() {
				console.log('willMount - ', this.constructor.name);
			}
			componentDidUpdate() {
				console.log('didUpdate - ', this.constructor.name);
			}
			render () {
				return state > 1 ? E : Z;
			}
		}

		class Z {
			componentWillUnmount() {
				console.log(this.this);
				console.log('willUnmount - ', this.constructor.name);
			}
			componentWillMount() {
				console.log('willMount - ', this.constructor.name);
			}
			componentDidUpdate() {
				console.log('didUpdate - ', this.constructor.name);
			}
			render() {
				return h('h1', 'I Am Z - ', state++)
			}
		}

		class E {
			componentWillUnmount() {
				console.log('willUnmount - ', this.constructor.name);
			}
			componentWillMount() {
				console.log('willMount - ', this.constructor.name);
			}
			componentDidUpdate() {
				console.log('didUpdate - ', this.constructor.name);
			}
			render () {
				return h('h2', 'I Am E - ', Date.now());
			}
		}

		var state = 0;

		function event (e) {
			return {};
		}

		function foos () {
			return h('button', {onclick: event}, 'Click Me - ', performance.now());
		}

		class Item {
			componentDidMount(el) {
				el.animate(animations.fadeIn, {
					duration: 200
				});
			}
			componentWillUnmount(el) {
				return new Promise((resolve) => {
					el.animate(animations.fadeOut, {
						duration: 200
					}).onfinish = resolve
				})
			}
			render() {
				return h('li', {
					// ref: ref
				}, this.props.children)
			}
		}

		class Lists {
			render() {
				return h('ul', 0, null, this.props.children.map(
					v => h(Item, {key: v}, v)
				))
			}
		}

		// dio.render(foo, root, h1);
		// dio.render({id: 1}, root);

		// dio.render(X, root);

		// setTimeout(()=>dio.render(X, root), 1000)
		// setTimeout(()=>dio.render(X, root), 2000)
		// setTimeout(()=>dio.render(null, root), 3000)

		// dio.render(h(App, Input, Input, Input), root);

		// setTimeout(dio.render, 1000, h(App, Input, Input, Input, Input), root);
		// setTimeout(dio.render, 2000, h(App, Input, Input, Input), root);

		// dio.render(h(Lists, 1, 2, 3), root)
		// setTimeout(dio.render, 500, h(Lists, 1, 2), root)

		// setTimeout(dio.render, 1000, h(Lists, 1, 2, 3, 4), root)
		// setTimeout(dio.render, 1500, h(Lists), root)
		// setTimeout(dio.render, 2000, h(Lists, 1, 2, 3, 4), root)

		class CustomProgressBar extends HTMLElement {
		   constructor() {
		       super();
		       const shadowRoot = this.attachShadow({mode: 'closed'});
		       shadowRoot.innerHTML = `
		           <style>
		               :host { display: inline-block; width: 5rem; height: 1rem; }
		               .progress { display: inline-block; position: relative; border: solid 1px #000; padding: 1px; width: 100%; height: 100%; }
		               .progress > .bar { background: #9cf; height: 100%; }
		               .progress > .label { position: absolute; top: 0; left: 0; width: 100%;
		                   text-align: center; font-size: 0.8rem; line-height: 1.1rem; }
		           </style>
		           <div class="progress" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">
		               <div class="bar" style="width: 0px;"></div>
		               <div class="label">0%</div>
		           </div>
		       `;
		       this._progressElement = shadowRoot.querySelector('.progress');
		       this._label = shadowRoot.querySelector('.label');
		       this._bar = shadowRoot.querySelector('.bar');
		   }

		   get progress() { return this._progressElement.getAttribute('aria-valuenow'); }
		   set progress(newPercentage) {
		       this._progressElement.setAttribute('aria-valuenow', newPercentage);
		       this._label.textContent = newPercentage + '%';
		       this._bar.style.width = newPercentage + '%';
		   }
		};
		customElements.define('custom-progress-bar', CustomProgressBar);

		// console.dir(CustomProgressBar)

		class Web {
			render () {
				// console.log(this.props)
				// return 'Hello';
				// return CustomProgressBar
				return h(CustomProgressBar, this.props)
			}
		}

		// dio.render(h(Web), root, () => {
			// for (let i = 0; i <= 10; i++) {
		    // setTimeout(((i) => document.querySelector('custom-progress-bar').progress = i * 10).bind(this, i), i * 100);
			// }
		// })

		const select = h('select', {value: ''},
			h('option', {value: ''}, 'a')
		)

		dio.render(h(root, {style: 'color:red;'}, select), app)
		// dio.render(h('div', select))

		// setTimeout(function () {
			// dio.render(h(Web, {style: 'color:red;'}), root)
		// }, 400)
	</script>
</body>
</html>
